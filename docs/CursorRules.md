# Cursor: правила для разработки бота

Эта шпаргалка описывает, как Cursor должен действовать при работе с репозиторием. Считай её «рамками ответственности» второго помощника, дополняющего Cascade.

Основные принципы
- Следуй settings.json как единому источнику правды по параметрам CV/OCR/FSM/Actions.
- Не вноси скрытых магий: любые эвристики и константы — только через конфиг и с описанием в README/docs.
- Стабильность важнее скорости: любые изменения FSM/CV сопровождай диагностикой (логи + debug PNG/JSON) и не ломай боевой сценарий.

FSM и действия
- Старт всегда через Overlay UI (dist/index.js) и кнопки Start/Stop; не плодить параллельных запусков.
- Уважай FocusGuard: никаких действий, если окно игры не активно. Заголовок «LU4  » должен совпадать.
- В TargetState соблюдай actions.clickOffsetY (по умолчанию 35) и задержки из actions.delays.*.
- Свип‑цикл камеры: plain → scroll up → plain → scroll down → … до появления целей. Не изменяй поведение без явного требования.

CV/OCR пайплайн
- Инициализация OpenCV через initCV до любых операций; SmokeTest должен проходить без ошибок.
- ROI/threshold/morph берём из settings.json. При изменении — сохранять диагностические артефакты в logs/images/<ts>/.
- OCR включаем только при cv.ocr.enabled=true; для появления блока ocr/afterOCR в bboxes.json требуется capture.debug=true.
- При необходимости меняй только параметры в конфиге; код пайплайна — по PR‑процессу и с примерами до/после в README.

Логи и диагностика
- Любой новый этап обработки сопровождай логами с таймингами и счётчиками (fullFrame/afterROI/…/afterMerge/afterOCR).
- Не засоряй репозиторий большими файлами: все артефакты — в logs/, автоматически чистятся по logRetentionMinutes.

Git/CI
- Всегда добавляй краткое описание изменений в README или отдельный md в docs/ при изменении поведения.
- Не коммить содержимое .cursor/, captures/, logs/ и прочие временные файлы.

Безопасность и окружение
- Режим действий по умолчанию — Arduino, порт из actions.serial.port; не жёстко кодируй COM‑порт в исходниках.
- Никогда не отключай FocusGuard в боевых ветках.

Чек‑лист перед пушем
- npm run build проходит.
- SmokeTest OK.
- Overlay UI стартует (localhost:3000), виден футер с build‑tag.
- README обновлён при изменении сценариев/параметров.
