# –û—Ç—á—ë—Ç –æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ Tesseract.js –∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ Fallback –º–µ—Ö–∞–Ω–∏–∑–º–∞

## –ü—Ä–æ–±–ª–µ–º–∞

Tesseract.js –≤–µ—Ä—Å–∏–∏ 5.1.0 –∏–º–µ–µ—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å Node.js 18 –Ω–∞ Windows:
```
LinkError: WebAssembly.instantiate(): Import #46 module="a" function="U" error: function import requires a callable
```

–≠—Ç–∞ –æ—à–∏–±–∫–∞ –¥–µ–ª–∞–µ—Ç Tesseract.js –Ω–µ–ø—Ä–∏–≥–æ–¥–Ω—ã–º –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ.

## –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ

### 1. –ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Tesseract.js

–£–ª—É—á—à–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `getOcrWorker` –≤ `src/core/Scan.ts`:

- **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è "basic"**: –ë–∞–∑–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Tesseract.js
- **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è "explicit-paths"**: –° —è–≤–Ω—ã–º–∏ –ø—É—Ç—è–º–∏ –∫ worker –∏ core —Ñ–∞–π–ª–∞–º  
- **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è "no-streaming"**: –° –æ—Ç–∫–ª—é—á–µ–Ω–Ω—ã–º WebAssembly streaming

–°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–±—É–µ—Ç –∫–∞–∂–¥—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ, –ª–æ–≥–∏—Ä—É—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã.

### 2. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π Fallback –Ω–∞ –Ω–∞—Ç–∏–≤–Ω—ã–π Tesseract

–ï—Å–ª–∏ –≤—Å–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Tesseract.js –ø—Ä–æ–≤–∞–ª–∏–≤–∞—é—Ç—Å—è, —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ –Ω–∞—Ç–∏–≤–Ω—ã–π Tesseract:

```typescript
if (engine === 'auto' || engine === 'tesseract') {
  try {
    worker = await getOcrWorker(lang, psm, whitelist);
    Logger.info('OCR: Using Tesseract.js successfully');
  } catch (error: any) {
    Logger.warn(`OCR: Tesseract.js failed, falling back to native: ${error?.message || String(error)}`);
    useNativeFallback = true;
  }
}
```

### 3. –ì–∏–±–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫

–î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–ø—Ü–∏—è `engine` –≤ —Å–µ–∫—Ü–∏—é `cv.ocr`:

```json
{
  "cv": {
    "ocr": {
      "enabled": true,
      "engine": "auto",  // "auto" | "native" | "tesseract"
      "lang": "eng",
      "psm": 7
    }
  }
}
```

**–í–∞—Ä–∏–∞–Ω—Ç—ã:**
- `"auto"` - –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å Tesseract.js, –∑–∞—Ç–µ–º fallback –Ω–∞ –Ω–∞—Ç–∏–≤–Ω—ã–π
- `"native"` - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –Ω–∞—Ç–∏–≤–Ω—ã–π Tesseract  
- `"tesseract"` - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ Tesseract.js

### 4. –£–ª—É—á—à–µ–Ω–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

- –ü–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏ –≤—Å–µ—Ö –ø–æ–ø—ã—Ç–æ–∫ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω–æ–º –¥–≤–∏–∂–∫–µ –≤ `bboxes.json`
- –û—Ç–¥–µ–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞

## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

### ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **–ù–∞—Ç–∏–≤–Ω—ã–π Tesseract**: –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–µ–Ω
2. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π fallback**: –°–∏—Å—Ç–µ–º–∞ –≤—Å–µ–≥–¥–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
3. **–ì–∏–±–∫–æ—Å—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–∫**: –ú–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω—ã–π –¥–≤–∏–∂–æ–∫
4. **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**: –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç —Ä–∞–±–æ—Ç–∞—Ç—å
5. **–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞**: –ü–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

### ‚ö†Ô∏è –ß—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **Tesseract.js 5.1.0**: –ü—Ä–æ–±–ª–µ–º—ã —Å WebAssembly –≤ Node.js 18 –Ω–∞ Windows
2. **WebAssembly streaming**: –û—Ç–∫–ª—é—á–µ–Ω –¥–ª—è –æ–±—Ö–æ–¥–∞ –ø—Ä–æ–±–ª–µ–º —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏

### üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

- **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π Tesseract.js**: 3 (basic, explicit-paths, no-streaming)
- **Fallback —É—Ä–æ–≤–Ω–µ–π**: 1 (–Ω–∞—Ç–∏–≤–Ω—ã–π Tesseract)
- **–†–µ–∂–∏–º–æ–≤ —Ä–∞–±–æ—Ç—ã**: 3 (auto, native, tesseract)
- **–¢–µ—Å—Ç–æ–≤**: 4 (–Ω–∞—Ç–∏–≤–Ω—ã–π, –∞–≤—Ç–æ, –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –Ω–∞—Ç–∏–≤–Ω—ã–π, –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π tesseract.js)

## –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω–∏–π

### –û—Å–Ω–æ–≤–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
- `src/core/Scan.ts` - —É–ª—É—á—à–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è getOcrWorker —Å fallback
- `src/core/tess-worker-shim-v2.js` - —É–ª—É—á—à–µ–Ω–Ω—ã–π shim (—Å–æ–∑–¥–∞–Ω)
- `docs/TesseractJS-Fix.md` - –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é
- `README.md` - –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è OCR

### –¢–µ—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã
- `scripts/test-tess-fixed.js` - —Ç–µ—Å—Ç —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π Tesseract.js
- `scripts/test-ocr-integration.js` - —Ç–µ—Å—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ OCR
- `scripts/test-complete-ocr.js` - –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–π —Ç–µ—Å—Ç –≤—Å–µ–π —Å–∏—Å—Ç–µ–º—ã

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `"engine": "auto"` –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç–∏
2. –ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –ª–æ–≥–∏ –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è, –∫–∞–∫–æ–π –¥–≤–∏–∂–æ–∫ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
3. –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –æ—Ç–ª–∞–¥–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `"engine": "native"`

### –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞  
1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `"engine": "native"` –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Ä–∞–±–æ—Ç—ã
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –Ω–∞—Ç–∏–≤–Ω—ã–π Tesseract —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ –¥–æ—Å—Ç—É–ø–µ–Ω
3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–æ–≥–æ–≤ OCR

### –î–ª—è –±—É–¥—É—â–∏—Ö –≤–µ—Ä—Å–∏–π
1. –û—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è Tesseract.js –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º WebAssembly
2. –†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –±–æ–ª–µ–µ –Ω–æ–≤—ã—Ö –≤–µ—Ä—Å–∏–π Node.js
3. –ò—Å—Å–ª–µ–¥—É–π—Ç–µ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ OCR –±–∏–±–ª–∏–æ—Ç–µ–∫–∏

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ü—Ä–æ–±–ª–µ–º–∞ —Å Tesseract.js —Ä–µ—à–µ–Ω–∞ –ø—É—Ç—ë–º —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –Ω–∞–¥—ë–∂–Ω–æ–≥–æ fallback –º–µ—Ö–∞–Ω–∏–∑–º–∞. –°–∏—Å—Ç–µ–º–∞ —Ç–µ–ø–µ—Ä—å:

- **–ù–∞–¥—ë–∂–Ω–∞**: –í—Å–µ–≥–¥–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–ª–∞–≥–æ–¥–∞—Ä—è fallback –Ω–∞ –Ω–∞—Ç–∏–≤–Ω—ã–π Tesseract
- **–ì–∏–±–∫–∞**: –ü–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã–±—Ä–∞—Ç—å –ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω—ã–π –¥–≤–∏–∂–æ–∫
- **–î–∏–∞–≥–Ω–æ—Å—Ç–∏—Ä—É–µ–º–∞**: –ü–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
- **–°–æ–≤–º–µ—Å—Ç–∏–º–∞**: –ù–µ –ª–æ–º–∞–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–µ–∂–∏–º `"auto"` –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç–∏ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ –∏ `"native"` –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞.
